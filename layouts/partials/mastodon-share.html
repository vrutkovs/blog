<a href="#" id="mastodon-share-button" aria-label="Share on Mastodon">
  <i class="fa-brands fa-mastodon"></i>
  <span>Share on Mastodon</span>
</a>

<style>
#mastodon-share-button {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  background-color: #6364FF;
  color: #fff;
  padding: 10px 15px;
  border-radius: 5px;
  text-decoration: none;
  font-weight: 500;
  transition: background-color 0.3s ease;
}
#mastodon-share-button:hover {
  background-color: #5354d9;
}
</style>

<script>
  document.getElementById('mastodon-share-button').addEventListener('click', function(event) {
    event.preventDefault();
    let mastodonInstance = localStorage.getItem('mastodonInstance');
    if (!mastodonInstance) {
      mastodonInstance = prompt("Please enter your Mastodon instance URL (e.g., mastodon.social)");
      if (mastodonInstance) {
        if (!mastodonInstance.startsWith('http')) {
            mastodonInstance = 'https://' + mastodonInstance;
        }
        try {
            new URL(mastodonInstance);
            localStorage.setItem('mastodonInstance', mastodonInstance);
        } catch (_) {
            alert('Invalid Mastodon instance URL.');
            return;
        }
      }
    }

    if (mastodonInstance) {
      const shareText = {{ .Title | plainify | safeJS }};
      const shareUrl = {{ .Permalink | safeJS }};
      const mastodonShareUrl = `${mastodonInstance}/share?text=${encodeURIComponent(shareText + ' - ' + shareUrl)}`;
      window.open(mastodonShareUrl, '_blank', 'noopener,noreferrer');
    }
  });
</script>
